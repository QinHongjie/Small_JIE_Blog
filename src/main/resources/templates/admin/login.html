<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
	<!-- css -->
	<th:block th:insert="_fragments :: head"></th:block>
	<title>博客管理 | 登录</title>
</head>
<body>

	<div class="m-container-small m-padded-tb-massive" style="max-width: 30em !important;position: relative;top: 100px;">
		<div class="ur container">
			<div class="ui middle aligned center aligned grid">
			  	<div class="column">

					<form class="ui large form" method="post">
						<div class="ui stacked segment m-padded-tb-large">
							<h2 class="ui teal image header">
								<div class="content">
									管理后台登录
								</div>
							</h2>
							<div class="field">
								<div class="ui left icon input">
									<i class="user icon"></i>
									<input type="text" name="username" placeholder="用户名">
								</div>
							</div>
							<div class="field">
								<div class="ui left icon input">
									<i class="lock icon"></i>
									<input type="password" name="password" placeholder="密码">
								</div>
							</div>
							<div id="loginBtn" class="ui fluid large teal button">登 录</div>
						</div>

						<div class="ui error message"></div>
						<div class="ui mini message negative" style="display:none;"></div>
					</form>

			  </div>
			</div>
		</div>
	</div>

	<!-- script -->
	<th:block th:replace="_fragments :: script"></th:block>
</body>
<script>

	$("#loginBtn").click(function () {
		if ( $("input[name='username']").val() == "" ) {
			$(".message.negative").text("请输入用户名！")
			$(".message.negative").show()
		} else if ($("input[name='password']").val() == "") {
			$(".message.negative").text("请输入密码！")
			$(".message.negative").show()
		} else {
			$.ajax({
				type: "POST",
				url: "/admin/login",
				data: $(".ui.form").serialize(),
				dataType: "JSON",
				success: function (data) {
					console.log(data)
					if (data.code == 200) {
						window.location.href = "/admin";
					} else {
						$(".message.negative").text(data.message)
						$(".message.negative").show()
					}
				}
			});
		}
	})
	$.ajax({
		type: "GET",
		url: "/api/getUserBySession",
		success: function (data) {
			if (data.code==200){
				window.location.href = "/admin"
			}
		}
	});


	/* 表单验证 */
	// $('.ui.form').form({
	// 	fields : {
	// 		username: {
	// 			identifier: 'username',
	// 			rules: [{
	// 				type: 'empty',
	// 				prompt: '请输入用户名'
	// 			}]
	// 		},
	// 		password: {
	// 			identifier: 'password',
	// 			rules: [{
	// 				type: 'empty',
	// 				prompt: '请输入密码'
	// 			}]
	// 		},
	// 	}
	// });
</script>
</html>
